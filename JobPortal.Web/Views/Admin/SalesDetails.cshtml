@using PagedList.Mvc
@using JobPortal.Domain
@using JobPortal.Library.Enumerators
@{
    ViewBag.Title = "Payments";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var pagedModel = ViewBag.Model as PagedList.IPagedList<JobPortal.Models.SalesDetails>;

    int minRowSize = ((pagedModel.PageNumber - 1) * pagedModel.PageSize) + 1;
    int totalRecord = (int)ViewBag.Rows;
    int maxRowSize = (pagedModel.PageNumber - 1) * pagedModel.PageSize + pagedModel.Count;
    if (totalRecord <= pagedModel.PageSize)
    {
        maxRowSize = totalRecord;
    }

}
<script src="~/Scripts/highcharts.js"></script>
<style>
    .cdate {
        padding-left: 0px;
        list-style-type: none;
    }

        .cdate li {
            display: inline-block;
            width: auto;
        }

    .control-label {
        padding-top: 6px;
        padding-left: 0px;
    }
</style>
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="title-login">
            <h1 style="margin-top: -15px;">Payments</h1>
            View Payments here
        </div>
    </div>
</div>
@if (ViewBag.Model != null)
{
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <span style="font-size:1em; font-weight:bold" class="cap"></span>
            <div class="form-group">
                <div id="container" class="list-group-item" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
            </div>
        </div>
    </div>
    <div class="clear" style="height:15px"></div>
    <form id="SearchForm">
        <input type="hidden" id="CountryId" name="countryId" value="@Request["countryId"]" />
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon" style="color:#000; text-align:left">From Date</span>
                        @Html.DropDownList("fd", new SelectList(SharedService.Instance.GetDayList()), "DAY", new { @class = "form-control" })
                        <span class="input-group-btn" style="width:0px"></span>
                        @Html.DropDownList("fm", new SelectList(SharedService.Instance.GetMonthList(), "Id", "Name"), "MONTH", new { @class = "form-control" })
                        <span class="input-group-btn" style="width:0px"></span>
                        @Html.DropDownList("fy", new SelectList(SharedService.Instance.GetYearList(false, DateTime.Now.Year - 1)), "YEAR", new { @class = "form-control" })
                    </div>
                    <div id="fromDateError" style="color:red;"></div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon" style="color:#000; text-align:left">To Date</span>
                        @Html.DropDownList("td", new SelectList(SharedService.Instance.GetDayList()), "DAY", new { @class = "form-control" })
                        <span class="input-group-btn" style="width:0px"></span>
                        @Html.DropDownList("tm", new SelectList(SharedService.Instance.GetMonthList(), "Id", "Name"), "MONTH", new { @class = "form-control" })
                        <span class="input-group-btn" style="width:0px"></span>
                        @Html.DropDownList("ty", new SelectList(SharedService.Instance.GetYearList(false, DateTime.Now.Year - 1)), "YEAR", new { @class = "form-control" })
                    </div>
                    <div id="toDateError" style="color:red;"></div>
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="form-group">
                    <input id="Name" name="Name" placeholder="SEARCH BY NAME" class="form-control" />
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4">
                <div class="form-group">
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2">
                <div class="form-group">
                    <input id="Search" type="submit" value="Search" class="btn btn-info btn-block" style="height:31px" />
                </div>
            </div>
        </div>
    </form>
    <div class="clear" style="height:15px"></div>
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="table-responsive">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div style="font-size:1.2em; background-color:#ede9e9; padding:4px;" class="cap"></div>
                    </div>
                </div>
                <table class="table table-striped table-bordered table-condensed" style="width:100%">
                    <tr>
                        <th>
                            Name
                        </th>
                        <th class="text-center">
                            Plus (US$)
                        </th>
                        <th class="text-center">
                            Advanced (US$)
                        </th>
                        <th class="text-center">
                            Pro (US$)
                        </th>
                        <th class="text-center">
                            Total (US$)
                        </th>
                        <th>Actions</th>
                    </tr>

                    @foreach (var item in ViewBag.Model)
                    {
                        <tr>
                            <td>
                                <a href="/@item.PermaLink" target="_blank">@item.FullName</a>
                            </td>

                            <td class="text-center">
                                @item.Plus
                            </td>
                            <td class="text-center">
                                @item.Advanced
                            </td>
                            <td class="text-center">
                                @item.Pro
                            </td>
                            <td class="text-center">
                                @item.Total
                            </td>
                            <td>
                                @if (item.UserType == (int)SecurityRoles.Employers)
                                {
                                    @Html.ActionLink("Manage", "ManageCompany", "Admin", new { Id = item.UserId }, new { target = "_blank" })
                                }
                                else if (item.UserType == (int)SecurityRoles.Jobseeker)
                                {
                                    @Html.ActionLink("Manage", "ManageIndividual", "Admin", new { Id = item.UserId }, new { target = "_blank" })
                                }
                            </td>
                        </tr>
                    }
                </table>
            </div>

            <div style="text-align:center; margin-top: -15px;">
                @Html.PagedListPager(pagedModel, PageNumber => Url.Action("SalesDetails",
            new RouteValueDictionary()
            {
                { "PageNumber" , PageNumber},
                { "countryId" , Request["countryId"]}
                //{ "StartDate" , Request["StartDate"]},
                //{ "EndDate" , Request["EndDate"]}
            }),
            PagedListRenderOptions.ClassicPlusFirstAndLast)
            </div>

        </div>
    </div>
}

<script>
    $(function () {
        var url = "/JsonHelper/SalesByCountry?countryId=@Request["countryId"]";

        $.post(url, {}, function (data) {
            if (data.length == 1) {
                var dataPoints = [];
                var item = data[0];
                $(".cap").text(item.CountryName + " - Payments")
                dataPoints.push({ name: "Plus", y: item.Plus });
                dataPoints.push({ name: "Advanced", y: item.Advanced });
                dataPoints.push({ name: "Pro", y: item.Pro });
                dataPoints.push({ name: "Total", y: (item.Plus + item.Advanced + item.Pro) });


                $('#container').highcharts({

                    colors: ['#FFB61C', '#b7c7a4', '#87D42E', '#475d8f'],
                    chart: {
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false,
                        type: 'pie'
                    },
                    title: {
                        text: ''
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>US${point.y}</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            depth: 10,
                            dataLabels: {
                                enabled: true,
                                distance: -30,
                                format: 'US${point.y}',
                                shadow: false,
                                style: {
                                    textShadow: "0 0 0px contrast, 0 0 0px contrast",
                                }
                            }
                        }
                    },
                    series: [{
                        type: 'pie',
                        name: 'Package',
                        data: dataPoints,
                        showInLegend: true,
                        dataLabels: {
                            enabled: true,
                            distance: -30,
                            format: 'US${point.y}',
                            shadow: false
                        }
                    }]
                });
            }
        });

    });
</script>
